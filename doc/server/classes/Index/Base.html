<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Index::Base</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
    <link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
    <script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
</head>

<body>     
    <div class="banner">
        <h1>
            <span class="type">Class</span> 
            Index::Base 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/picky/index/base_rb.html">lib/picky/index/base.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
    
    <div class="description">
        <p>
This class defines the indexing and index API that is exposed to the user
as the index method inside the <a
href="../Application.html">Application</a> class.
</p>
<p>
It provides a single front for both indexing and index options. We suggest
to always use the index API.
</p>
<p>
Note: An <a href="../Index.html">Index</a> holds both an
<b>Indexed</b>::<b>Index</b> and an <b>Indexing</b>::<b>Type</b>.
</p>

    </div>
    

    

    
    

    
    
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
    
        <dt>C</dt>
        <dd>
            <ul>
                
                <li><a href="#M000028">category</a>,</li>
                
                <li><a href="#M000025">check</a></li>
                
            </ul>
        </dd>
    
        <dt>D</dt>
        <dd>
            <ul>
                
                <li><a href="#M000027">define_category</a>,</li>
                
                <li><a href="#M000030">define_ranged_category</a></li>
                
            </ul>
        </dd>
    
        <dt>N</dt>
        <dd>
            <ul>
                
                <li><a href="#M000024">new</a></li>
                
            </ul>
        </dd>
    
        <dt>R</dt>
        <dd>
            <ul>
                
                <li><a href="#M000031">ranged_category</a></li>
                
            </ul>
        </dd>
    
        <dt>T</dt>
        <dd>
            <ul>
                
                <li><a href="#M000026">to_stats</a></li>
                
            </ul>
        </dd>
    
    </dl>
    

    

    

    

    

    
    <div class="sectiontitle">Attributes</div>
    <table border='0' cellpadding='5'>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>name</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>indexing</td>
            <td class='attr-desc'></td>
        </tr>
        
        <tr valign='top'>
            <td class='attr-rw'>
                [R]
            </td>
            <td class='attr-name'>indexed</td>
            <td class='attr-desc'></td>
        </tr>
        
    </table>
    

    
            <div class="sectiontitle">Class Public methods</div>
            
            <div class="method">
                <div class="title" id="M000024">
                    
                    <a name="M000024"></a><b>new</b>(name, source, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Create a new index with a given source.
</p>
<h3>Parameters</h3>
<ul>
<li>name: A name that will be used for the index directory and in the Picky
front end.

</li>
<li>source: Where the data comes from, e.g. <a
href="../Sources/CSV.html#M000191">Sources::CSV.new(...)</a>

</li>
</ul>
<h3>Options</h3>
<ul>
<li>result_identifier: Use if you&#8217;d like a different identifier/name in
the results than the name of the index.

</li>
<li>after_indexing: As of this writing only used in the db source. Executes the
given after_indexing as SQL after the indexing process.

</li>
</ul>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000024_source')" id="l_M000024_source">show</a>
                        
                        | <a href="http://github.com/floere/picky/blob/64dab00d2d4890edac2ae9ab786d9c32e829ea0f/server/lib/picky/index/base.rb#L24" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M000024_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/picky/index/base.rb, line 24</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span> = {}
      <span class="ruby-identifier">check</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">source</span>

      <span class="ruby-ivar">@name</span>     = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_sym</span>
      <span class="ruby-ivar">@indexing</span> = <span class="ruby-constant">Internals</span><span class="ruby-operator">::</span><span class="ruby-constant">Indexing</span><span class="ruby-operator">::</span><span class="ruby-constant">Index</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">source</span>, <span class="ruby-identifier">options</span>
      <span class="ruby-ivar">@indexed</span>  = <span class="ruby-constant">Internals</span><span class="ruby-operator">::</span><span class="ruby-constant">Indexed</span><span class="ruby-operator">::</span><span class="ruby-constant">Index</span>.<span class="ruby-identifier">new</span>  <span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>

      <span class="ruby-comment cmt"># Centralized registry.</span>
      <span class="ruby-comment cmt">#</span>
      <span class="ruby-constant">Indexes</span>.<span class="ruby-identifier">register</span> <span class="ruby-keyword kw">self</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="sectiontitle">Instance Public methods</div>
            
            <div class="method">
                <div class="title" id="M000028">
                    
                    <a name="M000028"></a><b>category</b>(category_name, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Base.html#M000027">define_category</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000025">
                    
                    <a name="M000025"></a><b>check</b>(name, source)
                    
                </div>
                
                <div class="description">
                  <p>
Since this is an API, we fail hard quickly.
</p>

                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000025_source')" id="l_M000025_source">show</a>
                        
                        | <a href="http://github.com/floere/picky/blob/64dab00d2d4890edac2ae9ab786d9c32e829ea0f/server/lib/picky/index/base.rb#L38" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M000025_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/picky/index/base.rb, line 38</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">source</span>
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;The index identifier (you gave \&quot;\#{name}\&quot;) for Index::Memory/Index::Redis should be a String/Symbol,\nExamples:\nIndex::Memory.new(:my_cool_index, ...) # Recommended\nIndex::Redis.new(\&quot;a-redis-index\&quot;, ...)\n&quot;</span>
) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_sym</span>)
      <span class="ruby-identifier">raise</span> <span class="ruby-constant">ArgumentError</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;The index \&quot;\#{name}\&quot; should use a data source that responds to the method #harvest, which yields(id, text).\nOr it could use one of the built-in sources:\nSources::\#{(Sources.constants - [:Base, :Wrappers, :NoCSVFileGiven, :NoCouchDBGiven]).join(',\nSources::')}\n&quot;</span>
) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:harvest</span>)
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000027">
                    
                    <a name="M000027"></a><b>define_category</b>(category_name, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Defines a searchable category on the index.
</p>
<h3>Parameters</h3>
<ul>
<li>category_name: This identifier is used in the front end, but also to
categorize query text. For example, “title:hobbit” will narrow the
hobbit query on categories with the identifier :title.

</li>
</ul>
<h3>Options</h3>
<ul>
<li>partial: Partial::None.new or Partial::Substring.new(from: starting_char,
to: ending_char). Default is Partial::Substring.new(from: -3, to: -1).

</li>
<li>similarity: Similarity::None.new or
Similarity::Phonetic.new(similar_words_searched). Default is
Similarity::None.new.

</li>
<li>qualifiers: An array of qualifiers with which you can define which category
you’d like to search, for example “title:hobbit” will search for
hobbit in just title categories. Example: qualifiers: [:t, :titre, :title]
(use it for example with multiple languages). Default is the name of the
category.

</li>
<li>qualifier: Convenience options if you just need a single qualifier, see
above. Example: qualifiers => :title. Default is the name of the category.

</li>
<li>source: Use a different source than the index uses. If you think you need
that, there might be a better solution to your problem. Please post to the
mailing list first with your application.rb :)

</li>
<li>from: Take the data from the data category with this name. Example: You
have a source <a
href="../Sources/CSV.html#M000191">Sources::CSV.new</a>(:title,
file:&#8217;some_file.csv&#8217;) but you want the category to be called
differently. The you use from: <a
href="Base.html#M000027">define_category</a>(:similar_title, :from =>
:title).

</li>
</ul>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Base.html#M000028">category</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000027_source')" id="l_M000027_source">show</a>
                        
                        | <a href="http://github.com/floere/picky/blob/64dab00d2d4890edac2ae9ab786d9c32e829ea0f/server/lib/picky/index/base.rb#L81" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M000027_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/picky/index/base.rb, line 81</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_category</span> <span class="ruby-identifier">category_name</span>, <span class="ruby-identifier">options</span> = {}
      <span class="ruby-identifier">category_name</span> = <span class="ruby-identifier">category_name</span>.<span class="ruby-identifier">to_sym</span>

      <span class="ruby-identifier">indexing_category</span> = <span class="ruby-identifier">indexing</span>.<span class="ruby-identifier">define_category</span> <span class="ruby-identifier">category_name</span>, <span class="ruby-identifier">options</span>
      <span class="ruby-identifier">indexed_category</span>  = <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">define_category</span>  <span class="ruby-identifier">category_name</span>, <span class="ruby-identifier">options</span>

      <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">indexing_category</span>, <span class="ruby-identifier">indexed_category</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>

      <span class="ruby-keyword kw">self</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000030">
                    
                    <a name="M000030"></a><b>define_ranged_category</b>(category_name, range, options = {})
                    
                </div>
                
                <div class="description">
                  <pre>
 HIGHLY EXPERIMENTAL Try if you feel &quot;beta&quot; ;)
</pre>
<p>
Make this category range searchable with a fixed range. If you need other
ranges, define another category with a different range value.
</p>
<p>
Example: You have data values inside 1..100, and you want to have Picky
return not only the results for 47 if you search for 47, but also results
for 45, 46, or 47.2, 48.9, in a range of 2 around 47, so (45..49).
</p>
<p>
Then you use:
</p>
<pre>
 my_index.define_ranged_category :values_inside_1_100, 2
</pre>
<p>
Optionally, you give it a precision value to reduce the error margin around
47 (Picky is a bit liberal).
</p>
<pre>
 my_index.define_ranged_category :values_inside_1_100, 2, precision: 5
</pre>
<p>
This will force Picky to maximally be wrong 5% of the given range value (5%
of 2 = 0.1) instead of the default 20% (20% of 2 = 0.4).
</p>
<p>
We suggest not to use much more than 5 as a higher precision is more
performance intensive for less and less precision gain.
</p>
<h2>Protip 1</h2>
<p>
Create two ranged categories to make an area search:
</p>
<pre>
  index.define_ranged_category :x, 1
  index.define_ranged_category :y, 1
</pre>
<p>
<a href="../Search.html">Search</a> for it using for example:
</p>
<pre>
  x:133, y:120
</pre>
<p>
This will search this square area (* = 133, 120: The &#8220;search&#8221;
point entered):
</p>
<pre>
   132       134
    |         |
  --|---------|-- 121
    |         |
    |    *    |
    |         |
  --|---------|-- 119
    |         |
</pre>
<p>
Note: The area does not need to be square, but can be rectangular.
</p>
<h2>Protip 2</h2>
<p>
Create three ranged categories to make a volume search.
</p>
<p>
Or go crazy and use 4 ranged categories for a space/time search! ;)
</p>
<h3>Parameters</h3>
<ul>
<li>category_name: The category_name as used in <a
href="Base.html#M000027">define_category</a>.

</li>
<li>range: The range (in the units of your data values) around the query point
where we search for results.

</li>
</ul>
<pre>
 -----|&lt;- range  -&gt;*------------|-----
</pre>
<h3>Options</h3>
<ul>
<li>precision: Default is 1 (20% error margin, very fast), up to 5 (5% error
margin, slower) makes sense.

</li>
<li>&#8230; all options of <a href="Base.html#M000027">define_category</a>.

</li>
</ul>

                </div>
                
                
                <div class="aka">
                    This method is also aliased as
                    
                    <a href="Base.html#M000031">ranged_category</a>
                    
                </div>
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000030_source')" id="l_M000030_source">show</a>
                        
                        | <a href="http://github.com/floere/picky/blob/64dab00d2d4890edac2ae9ab786d9c32e829ea0f/server/lib/picky/index/base.rb#L152" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M000030_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/picky/index/base.rb, line 152</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_ranged_category</span> <span class="ruby-identifier">category_name</span>, <span class="ruby-identifier">range</span>, <span class="ruby-identifier">options</span> = {}
      <span class="ruby-identifier">precision</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:precision</span>]

      <span class="ruby-identifier">options</span> = { <span class="ruby-identifier">partial</span><span class="ruby-operator">:</span> <span class="ruby-constant">Partial</span><span class="ruby-operator">::</span><span class="ruby-constant">None</span>.<span class="ruby-identifier">new</span> }.<span class="ruby-identifier">merge</span> <span class="ruby-identifier">options</span>

      <span class="ruby-identifier">define_category</span> <span class="ruby-identifier">category_name</span>, <span class="ruby-identifier">options</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">indexing</span>, <span class="ruby-identifier">indexed</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">indexing</span>.<span class="ruby-identifier">source</span>    = <span class="ruby-constant">Sources</span><span class="ruby-operator">::</span><span class="ruby-constant">Wrappers</span><span class="ruby-operator">::</span><span class="ruby-constant">Location</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">indexing</span>, <span class="ruby-identifier">grid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">range</span>, <span class="ruby-identifier">precision</span><span class="ruby-operator">:</span> <span class="ruby-identifier">precision</span>
        <span class="ruby-identifier">indexing</span>.<span class="ruby-identifier">tokenizer</span> = <span class="ruby-constant">Internals</span><span class="ruby-operator">::</span><span class="ruby-constant">Tokenizers</span><span class="ruby-operator">::</span><span class="ruby-constant">Index</span>.<span class="ruby-identifier">new</span>

        <span class="ruby-identifier">exact_bundle</span>    = <span class="ruby-constant">Indexed</span><span class="ruby-operator">::</span><span class="ruby-constant">Wrappers</span><span class="ruby-operator">::</span><span class="ruby-constant">Bundle</span><span class="ruby-operator">::</span><span class="ruby-constant">Location</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">exact</span>, <span class="ruby-identifier">grid</span><span class="ruby-operator">:</span> <span class="ruby-identifier">range</span>, <span class="ruby-identifier">precision</span><span class="ruby-operator">:</span> <span class="ruby-identifier">precision</span>
        <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">exact</span>   = <span class="ruby-identifier">exact_bundle</span>
        <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">partial</span> = <span class="ruby-identifier">exact_bundle</span> <span class="ruby-comment cmt"># A partial token also uses the exact index.</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
            <div class="method">
                <div class="title" id="M000031">
                    
                    <a name="M000031"></a><b>ranged_category</b>(category_name, range, options = {})
                    
                </div>
                
                <div class="description">
                  <p>
Alias for <a href="Base.html#M000030">define_ranged_category</a>
</p>

                </div>
                
                
                
            </div>
            
            <div class="method">
                <div class="title" id="M000026">
                    
                    <a name="M000026"></a><b>to_stats</b>()
                    
                </div>
                
                
                
                
                <div class="sourcecode">
                    <p class="source-link">
                        Source: <a href="javascript:toggleSource('M000026_source')" id="l_M000026_source">show</a>
                        
                        | <a href="http://github.com/floere/picky/blob/64dab00d2d4890edac2ae9ab786d9c32e829ea0f/server/lib/picky/index/base.rb#L57" target="_blank" class="github_url">on GitHub</a>
                        
                    </p>
                    <div id="M000026_source" class="dyn-source">
                        <pre><span class="ruby-comment cmt"># File lib/picky/index/base.rb, line 57</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_stats</span>
      <span class="ruby-identifier">stats</span> = <span class="ruby-value str">&quot;\#{name} (\#{self.class}):\n\#{\&quot;source:            \#{indexing.source}\&quot;.indented_to_s}\n\#{\&quot;categories:        \#{indexing.categories.categories.map(&amp;:name).join(', ')}\&quot;.indented_to_s}\n&quot;</span>
      <span class="ruby-identifier">stats</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;  result identifier: \&quot;#{indexed.result_identifier}\&quot;&quot;</span>.<span class="ruby-identifier">indented_to_s</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">result_identifier</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">indexed</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-identifier">stats</span>
    <span class="ruby-keyword kw">end</span></pre>
                    </div>
                </div>
                
            </div>
            
</div>
    </div>
  </body>
</html>    