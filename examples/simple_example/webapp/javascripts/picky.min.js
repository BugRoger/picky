Array.prototype.index=function(a){for(var e=0,g=this.length;e<g;e++)if(this[e]==a)return e;return null};Array.prototype.include=function(a){return this.index(a)!==null};Array.prototype.remove=function(a){this.splice(a,1);return this};var PickyI18n={};$(function(){PickyI18n.locale=$("html").attr("lang")||"en"});
var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(a){for(var e=PickyI18n.locale||
"en",g=a.split(".").concat(e),b=dictionary,i=0,r=g.length;i<r;i++){b=b[g[i]];if(b==undefined){b="Translation missing: "+a+"."+e;break}}return b};function Allocation(a,e,g,b,i,r){var f=this;this.type=a;this.weight=e;this.count=g;this.combination=b;this.ids=i||[];this.entries=this.rendered=r||[];this.isType=function(j){return j==f.type}}function Allocations(a){this.allocations=[];for(var e=0,g=a.length;e<g;e++){var b=a[e];this.allocations.push(new Allocation(b[0],b[1],b[2],b[3],b[4],b[5]))}this.length=this.allocations.length;this.each=function(i){return $.each(this.allocations,i)}}
function PickyData(a){var e=a.total,g=a.duration,b=a.offset;a=new Allocations(a.allocations||[]);this.total=e;this.duration=g;this.offset=b;this.allocations=a;this.isEmpty=function(){return e==0}};var PickyView=function(a,e){var g=e.showResultsLimit||10,b=$("#picky input.query"),i=$("#picky div.reset"),r=$("#picky input.search_button"),f=$("#picky div.status"),j=$("#picky .dashboard"),s=$("#picky .results"),k=$("#picky .no_results"),d=new PickyAddination(this,s),o=new PickyAllocationsCloud(this),u=new PickyResultsRenderer(d),w=function(){i.fadeTo(166,1)},y=function(){o.hide();s.empty();k.hide()},D=function(m){b.val(m);i.fadeTo(166,0);B("empty");f.empty();y()},x=function(){return b.val()};this.text=
x;var A=function(m){f.text(m);m>0&&m<=5&&f.fadeTo("fast",0.5).fadeTo("fast",1)},E=function(m){if(m.isEmpty())return"none";if(m.total>g&&m.allocations.length>1)return"support";return"ok"},B=function(m){j.attr("class","dashboard "+m)};this.insert=function(m){b.val(m);b.select()};this.fullResultsCallback=function(m){B(E(m));if(m.isEmpty()){y();A(0);k.show();w()}else if(m.total>g&&m.allocations.length>1){y();w();o.show(m);A(m.total)}else if(m.offset==0){y();A(m.total);u.render(m);s.show();w()}else{d.remove();
u.render(m);$.scrollTo("#picky .results div.info:last",{duration:500,offset:-12})}b.focus()};this.liveResultsCallback=function(m){B(E(m));A(m.total)};this.allocationChosen=function(m){m=m.data.query;b.val(m);a.allocationChosen(m)};this.addinationClicked=function(m){a.addinationClicked(x(),m)};(function(){b.keyup(function(m){if(x()==""){D();a.searchTextCleared()}else{a.searchTextEntered(x(),m);w()}});r.click(function(){x()==""||a.searchButtonClicked(x())});i.click(function(){D("");a.clearButtonClicked();
b.focus()})})();b.focus()};var PickyBackend=function(a){var e=function(g,b,i,r){var f=r||{};f=$.extend({query:g,offset:i},r);$.ajax({type:"GET",url:a,data:f,success:function(j){b&&b(new PickyData(j))},dataType:"json"})};this.search=function(g,b,i,r,f){e(g,function(j){b&&b(f,j)},i,r)}},LiveBackend=function(a){var e=new PickyBackend(a);this.search=function(g,b,i,r,f){f=f||{};latestRequestTimestamp=new Date;f.live=latestRequestTimestamp;e.search(g,function(j,s){if(!j.live||j.live==latestRequestTimestamp)b&&b(s)},i,r,f)}},FullBackend=
function(a){var e=new PickyBackend(a);this.search=function(g,b,i,r,f){f=f||{};latestRequestTimestamp=new Date;f.full=latestRequestTimestamp;e.search(g,function(j,s){if(!j.full||j.full==latestRequestTimestamp)b&&b(s)},i,r,f)}};var PickyController=function(a){var e=new PickyView(this,a),g=a.backends,b=a.before||function(){},i=a.success||function(){},r=a.after||function(){},f=function(d,o){d=i(d,o)||d;e.fullResultsCallback(d);r(d,o)},j=function(d,o,u){u=u||{};o=o||0;k.stop();u=b(u,d,o)||u;var w=g.full;w&&w.search(d,f,o,u)},s=function(d,o){d=i(d,o)||d;e.liveResultsCallback(d);r(d,o)},k=$.timer(180,function(d){var o=e.text();b({});var u=g.live;u&&u.search(o,s,0,void 0);d.stop()});k.stop();this.insert=function(d,o){e.insert(d);
o&&j(d)};this.clearButtonClicked=function(){k.stop()};this.searchTextCleared=function(){k.stop()};this.searchTextEntered=function(d,o){if($.inArray(o.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)o.keyCode==13?j(d):k.reset()};this.searchButtonClicked=function(d){j(d)};this.allocationChosen=function(d){j(d)};this.addinationClicked=function(d,o){j(d,o.data.offset)}};var PickyClient=function(a){Localization.qualifiers=a.qualifiers;Localization.explanations=a.explanations;var e=a.backends;if(e){e.live||alert("Both a full and live backend must be provided.");e.full||alert("Both a full and live backend must be provided.")}else a.backends={live:a.live&&new LiveBackend(a.live)||alert("A live backend path must be provided."),full:a.full&&new FullBackend(a.full)||alert("A live backend path must be provided.")};var g=a.controller&&new a.controller(a)||new PickyController(a);
this.insert=function(b,i){g.insert(b,i||true)}};var PickyAddination=function(a,e){this.remove=function(){e.find(".addination").remove()};this.render=function(g){var b=g.total,i=void 0;i=i||0;i=g.offset+20+i;var r=i+20;g=g.total;if(g<r)r=g;g={offset:i,start:i+1,end:r};if(g.offset<b){b=$("<div class='addination current'>"+t("results.addination.more")+"<div class='tothetop'><a href='javascript:$.scrollTo(0,{ duration: 500});'>&uarr;</a></div></div>");b.bind("click",{offset:g.offset},a.addinationClicked);return b}else return""}};var PickyResultsRenderer=function(a){var e=["street_number","zipcode"],g=function(f){var j=f[f.length-1];f=f.slice(0,f.length-1);if(f==[])f=[f];if(!e.include(j[0]))if(j[1].match(/[^\*~]$/))j[1]+="*";f.push(j);return f},b=function(f){for(var j=Localization.explanations&&Localization.explanations[PickyI18n.locale]||{},s=[],k,d=0,o=f.length;d<o;d++){k=f[d];var u=k[0];u=j[u]||u;s.push([u,k[1]])}return s},i=function(f,j){var s=Localization.explanation_delimiters[PickyI18n.locale],k=b(g(j));k=$.map(k,function(d){return[d[0].replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0]+)/,
"<strong>$1</strong>"),d[1]].join(" ")});k=k.join(" "+s+" ");return'<div class="explanation">'+f+" "+k+"</div>"},r=function(f,j){var s='<div class="info">';s+=i(j.type,j.combination);if(f.offset>0)s+='<div class="tothetop"><a href="javascript:$.scrollTo(0,{ duration: 500 });">&uarr;</a></div>';s+='<div class="clear"></div></div>';return s};this.render=function(f){var j=$("#picky .results");f.allocations.each(function(s,k){j.append(r(f,k)).append(k.entries.join("")).append(a.render(f))})}};var Localization={qualifiers:{},explanations:{},location_delimiters:{de:"in",fr:"\u00e0",it:"a",en:"in",ch:"in"},explanation_delimiters:{de:"und",fr:"et",it:"e",en:"and",ch:"und"}};
function AllocationRenderer(a){function e(c){var n={},p={},h=[],q;q=0;for(l=c.length;q<l;q++){var v=c[q][0];if(v in n){n[v]=n[v]+" "+c[q][1];h.push(q)}else{n[v]=c[q][1];p[q]=v}}for(q in p)c[q][1]=n[p[q]];for(q=h.length-1;q>=0;q--)c.remove(h[q]);return c}function g(c,n){var p=n||false,h=c[0],q=c[1],v=B[h];if(v){if(v.method)q=q[v.method]();if(v.format)q=v.format.replace(/%1\$s/,q)}h=y[h]||h;if(p&&!(v&&v.ignoreSingle))return q+"&nbsp;("+h+")";return q}function b(c){if(c.length==0)return"";else if(c.length==
1)return g(c[0],true);else{var n=[],p=[];c=e(c);for(var h=0,q=c.length;h<q;h++)if(c[h][0]=="first_name")n.unshift(g(c[h]));else c[h][0]=="maiden_name"?p.push(g(c[h])):n.push(g(c[h]));p.length>0&&n.push(p);return n.join(" ")}}function i(c){return function(n,p){for(var h=0,q=c.length;h<q;h++)if(c[h][0]==p)return c[h][1];return""}}function r(c){if(c.length==0)return"";var n=c=e(c);n.sort(function(v,z){return v[0]<z[0]?-1:1});for(var p=[],h=0,q=n.length;h<q;h++)p.push(n[h][0]);return m[p].replace(/:(zipcode|city)/g,
i(c))}function f(c){var n=c[0];return c[1]+"&nbsp;("+(y[n]||n)+")"}function j(c){if(c.length==0)return"";result=[];c=e(c);for(var n=0,p=c.length;n<p;n++)result.push(f(c[n]));return result.join(", ")}function s(c){for(var n=[],p=[],h=[],q=0,v=c.length;q<v;q++){var z=c[q];if(F.include(z[0]))h.push(z);else G.include(z[0])?n.push(z):p.push(z)}var C;if(h.length>0)C=h[h.length-1];else if(p.length>0)C=p[p.length-1];else if(n.length>0)C=n[n.length-1];E.include(C[0])||(C[1]+="...");c=b(n);p=j(p);h=r(h);return[c,
p,h]}function k(c){var n=c[0],p=c[1];c=c[2];var h="";h=n!=""?p!=""?[n,p].join(", "):n:p;if(c=="")return h;return[h,c].join(" "+D+"&nbsp;")}function d(c){var n=[],p,h;for(h in c){p=c[h][0];p=w[p]||p;n[h]=p+":"+c[h][1]}return n.join(" ")}var o=this,u=PickyI18n.locale,w=Localization.qualifiers&&Localization.qualifiers[u]||{},y=Localization.explanations&&Localization.explanations[u]||{},D=Localization.location_delimiters[u],x=a.combination,A=a.count;this.explanation=this.query=this.text="";var E=["street_number",
"zipcode"];this.contract=e;var B={maiden_name:{format:"(-%1$s)",method:"capitalize",ignoreSingle:true},name:{format:"<strong>%1$s</strong>",method:"toUpperCase",ignoreSingle:true},first_name:{format:"%1$s",method:"capitalize"}};this.who=b;var m={zipcode:":zipcode ["+y.city+"]",city:":city","city,zipcode":":zipcode :city"};this.where=r;this.what=j;var G=["first_name","name","maiden_name"],F=["zipcode","city"];this.trisect=s;this.fuse=k;this.querify=d;this.generate=function(){this.query=d(x);this.text=
k(s(x));return o};this.listItem=function(){return $('<li><div class="text">'+this.text+'</div><div class="count">'+A+"</div></li>")}};var PickyAllocationsCloud=function(a){var e=$("#picky .allocations"),g=e.find(".shown"),b=e.find(".more"),i=e.find(".hidden"),r=function(){e.hide()},f=function(k){var d=k.listItem();d.bind("click",{query:k.query,type:k.type},function(o){r();a.allocationChosen(o)});return d},j=function(k){var d=[];k.each(function(o,u){var w=new AllocationRenderer(u);w.generate();w=f(w);d.push(w)});return d},s=function(k){if(k.length==0)return $("#search .allocations").hide();g.empty();b.hide();i.empty().hide();if(k.length>
3){$.each(k.slice(0,2),function(d,o){g.append(o)});$.each(k.slice(2),function(d,o){i.append(o)});b.show()}else $.each(k,function(d,o){g.append(o)});return $("#search .allocations").show()};b.click(function(){b.hide();i.show()});this.hide=r;this.show=function(k){s(j(k.allocations));e.show()}};
