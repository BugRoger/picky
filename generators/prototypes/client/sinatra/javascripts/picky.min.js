Array.prototype.index=function(b){for(var g=0,i=this.length;g<i;g++)if(this[g]==b)return g;return null};Array.prototype.include=function(b){return this.index(b)!==null};Array.prototype.remove=function(b){this.splice(b,1);return this};var PickyI18n={};$(function(){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en"});
var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(b){for(var g=PickyI18n.locale||
"en",i=b.split(".").concat(g),c=dictionary,f=0,p=i.length;f<p;f++){c=c[i[f]];if(c==undefined){c="Translation missing: "+b+"."+g;break}}return c};function Allocation(b,g,i,c,f,p){var u=this;this.type=b;this.weight=g;this.count=i;this.combination=c;this.ids=f||[];this.entries=this.rendered=p||[];this.isType=function(e){return e==u.type}}function Allocations(b){this.allocations=[];for(var g=0,i=b.length;g<i;g++){var c=b[g];this.allocations.push(new Allocation(c[0],c[1],c[2],c[3],c[4],c[5]))}this.length=this.allocations.length;this.each=function(f){return $.each(this.allocations,f)}}
function PickyData(b){var g=b.total,i=b.duration,c=b.offset;b=new Allocations(b.allocations||[]);this.total=g;this.duration=i;this.offset=c;this.allocations=b;this.isEmpty=function(){return g==0}};var PickyView=function(b,g){var i=g.showResultsLimit||10,c=$("#picky input.query"),f=$("#picky div.reset"),p=$("#picky input.search_button"),u=$("#picky div.status"),e=$("#picky .dashboard"),q=$("#picky .results"),s=$("#picky .no_results"),r=new PickyAddination(this,q),d=new PickyAllocationsCloud(this),n=new PickyResultsRenderer(r),v=function(){f.fadeTo(166,1)},x=function(){d.hide();q.empty();s.hide()},A=function(k){c.val(k);f.fadeTo(166,0);C("empty");u.empty();x()},y=function(){return c.val()};this.text=
y;var B=function(k){u.text(k);k>0&&k<=5&&u.fadeTo("fast",0.5).fadeTo("fast",1)},E=function(k){if(k.isEmpty())return"none";if(k.total>i&&k.allocations.length>1)return"support";return"ok"},C=function(k){e.attr("class","dashboard "+k)};this.insert=function(k){c.val(k);c.select()};this.fullResultsCallback=function(k){C(E(k));if(k.isEmpty()){x();B(0);s.show();v()}else if(k.total>i&&k.allocations.length>1){x();v();d.show(k);B(k.total)}else if(k.offset==0){x();B(k.total);n.render(k);q.show();v();c.focus()}else{r.remove();
n.render(k);$("body").animate({scrollTop:$("#picky div.results div.header:last").position().top-12},500)}};this.liveResultsCallback=function(k){C(E(k));B(k.total)};this.allocationChosen=function(k){k=k.data.query;c.val(k);b.allocationChosen(k)};this.addinationClicked=function(k){b.addinationClicked(y(),k)};(function(){c.keyup(function(k){if(y()==""){A();b.searchTextCleared()}else{b.searchTextEntered(y(),k);v()}});p.click(function(){y()==""||b.searchButtonClicked(y())});f.click(function(){A("");b.clearButtonClicked();
c.focus()})})();c.focus()};var PickyBackend=function(b){var g=function(i,c,f,p){var u=p||{};u=$.extend({query:i,offset:f},p);$.getJSON(b,u,function(e){c&&c(new PickyData(e))})};this.search=function(i,c,f,p,u){g(i,function(e){c&&c(u,e)},f,p)}},LiveBackend=function(b){var g=new PickyBackend(b);this.search=function(i,c,f,p,u){u=u||{};latestRequestTimestamp=new Date;u.live=latestRequestTimestamp;g.search(i,function(e,q){if(!e.live||e.live==latestRequestTimestamp)c&&c(q)},f,p,u)}},FullBackend=function(b){var g=new PickyBackend(b);
this.search=function(i,c,f,p,u){u=u||{};latestRequestTimestamp=new Date;u.full=latestRequestTimestamp;g.search(i,function(e,q){if(!e.full||e.full==latestRequestTimestamp)c&&c(q)},f,p,u)}};var PickyController=function(b){var g=new PickyView(this,b),i=b.backends,c=b.before||function(){},f=b.success||function(){},p=b.after||function(){},u=function(d,n){d=f(d,n)||d;g.liveResultsCallback(d);p(d,n)},e,q=function(){var d=g.text();c({});var n=i.live;n&&n.search(d,u,0,void 0);clearInterval(e)};e=setInterval(q,180);clearInterval(e);var s=function(d,n){d=f(d,n)||d;g.fullResultsCallback(d);p(d,n)},r=function(d,n,v){v=v||{};n=n||0;clearInterval(e);$.address&&$.address.parameter("q",d);v=c(v,d,
n)||v;var x=i.full;x&&x.search(d,s,n,v)};this.insert=function(d,n){g.insert(d);n&&r(d)};this.clearButtonClicked=function(){clearInterval(e)};this.searchTextCleared=function(){clearInterval(e)};this.searchTextEntered=function(d,n){if($.inArray(n.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(n.keyCode==13)r(d);else{clearInterval(e);e=setInterval(q,180)}};this.searchButtonClicked=function(d){r(d)};this.allocationChosen=
function(d){r(d)};this.addinationClicked=function(d,n){r(d,n.data.offset)}};var Localization={location_delimiters:{de:"in",fr:"\u00e0",it:"a",en:"in",ch:"in"},explanation_delimiters:{de:"und",fr:"et",it:"e",en:"and",ch:"und"}},PickyClient=function(b){Localization.qualifiers=b.qualifiers||{};Localization.explanations=b.explanations||{};Localization.explanation_delimiters={de:"und",fr:"et",it:"e",en:"and",ch:"und"};var g=b.backends;if(g){g.live||alert("Both a full and live backend must be provided.");g.full||alert("Both a full and live backend must be provided.")}else b.backends=
{live:b.live&&new LiveBackend(b.live)||alert("A live backend path must be provided."),full:b.full&&new FullBackend(b.full)||alert("A live backend path must be provided.")};var i=b.controller&&new b.controller(b)||new PickyController(b);var c=this.insert=function(f,p){i.insert(f,p||true)};this.insertFromURL=function(f){if(f&&f!="")c(f);else $.address&&c($.address.parameter("q"))};$.address&&$.address.externalChange(function(f){(f=f.parameters.q)&&c(f)})};var PickyAddination=function(b,g){this.remove=function(){g.find(".addination").remove()};this.render=function(i){var c=i.total,f;f=i.offset+20+0;var p=f+20;i=i.total;if(i<p)p=i;f={offset:f,start:f+1,end:p};if(f.offset<c){c=$("<div class='addination'>"+t("results.addination.more")+"</div>");c.bind("click",{offset:f.offset},b.addinationClicked);return c}else return""}};var PickyResultsRenderer=function(b){var g=["street_number","zipcode"],i=function(e){var q=e[e.length-1];e=e.slice(0,e.length-1);if(e==[])e=[e];if(!g.include(q[0]))if(q[1].match(/[^\*~]$/))q[1]+="*";e.push(q);return e},c=function(e){for(var q=Localization.explanations&&Localization.explanations[PickyI18n.locale]||{},s=[],r,d=0,n=e.length;d<n;d++){r=e[d];var v=r[0];v=q[v]||v;s.push([v,r[1]])}return s},f=function(e,q){return[e.replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0]+)/,
"<strong>$1</strong>"),q].join(" ")},p=function(e,q){var s=Localization.explanation_delimiters[PickyI18n.locale],r=c(i(q)),d="",n=[];r=$.map(r,function(v){var x=v[0];v=v[1];if(d==""||x==d){n.push(v);d=x}else{var A=f(d,n.join(" "));n=[];n.push(v);d=x;return A}});r.push(f(d,n.join(" ")));r=r.join(" "+s+" ");return'<span class="explanation">'+e+" "+r+"</span>"},u=function(e,q){var s='<div class="header">';s+=p(q.type,q.combination);if(e.offset>0)s+='<div class="tothetop"><a href="#" onclick="javascript:$(\'body\').animate({scrollTop: 0}, 500);">&uarr;</a></div>';
return s};this.render=function(e){var q=$("#picky div.results");e.allocations.each(function(s,r){q.append(u(e,r)).append('<ol class="results">'+r.entries.join("")+"</ol>").append(b.render(e))})}};function AllocationRenderer(b){function g(a){var h={},m={},j=[],o;o=0;for(l=a.length;o<l;o++){var w=a[o][0];if(w in h){h[w]=h[w]+" "+a[o][1];j.push(o)}else{h[w]=a[o][1];m[o]=w}}for(o in m)a[o][1]=h[m[o]];for(o=j.length-1;o>=0;o--)a.remove(j[o]);return a}function i(a,h){var m=h||false,j=a[0],o=a[1],w=A[j];if(w){if(w.method)o=o[w.method]();if(w.format)o=w.format.replace(/%1\$s/,o)}j=v[j]||j;if(m&&!(w&&w.ignoreSingle))return o+"&nbsp;("+j+")";return o}function c(a){if(a.length==0)return"";else if(a.length==
1)return i(a[0],true);else{var h=[],m=[];a=g(a);for(var j=0,o=a.length;j<o;j++)if(a[j][0]=="first_name")h.unshift(i(a[j]));else a[j][0]=="maiden_name"?m.push(i(a[j])):h.push(i(a[j]));m.length>0&&h.push(m);return h.join(" ")}}function f(a){return function(h,m){for(var j=0,o=a.length;j<o;j++)if(a[j][0]==m)return a[j][1];return""}}function p(a){if(a.length==0)return"";var h=a=g(a);h.sort(function(w,z){return w[0]<z[0]?-1:1});for(var m=[],j=0,o=h.length;j<o;j++)m.push(h[j][0]);return y[m].replace(/:(zipcode|city)/g,
f(a))}function u(a){var h=a[0];return a[1]+"&nbsp;("+(v[h]||h)+")"}function e(a){if(a.length==0)return"";result=[];a=g(a);for(var h=0,m=a.length;h<m;h++)result.push(u(a[h]));return result.join(", ")}function q(a){for(var h=[],m=[],j=[],o=0,w=a.length;o<w;o++){var z=a[o];if(E.include(z[0]))j.push(z);else B.include(z[0])?h.push(z):m.push(z)}var D;if(j.length>0)D=j[j.length-1];else if(m.length>0)D=m[m.length-1];else if(h.length>0)D=h[h.length-1];x.include(D[0])||(D[1]+="...");a=c(h);m=e(m);j=p(j);return[a,
m,j]}function s(a){var h=a[0],m=a[1];a=a[2];var j="";j=h!=""?m!=""?[h,m].join(C):h:m;if(a=="")return j;return[j,a].join(k)}function r(a){var h=[],m,j;for(j in a){m=a[j][0];m=n[m]||m;h[j]=m+":"+a[j][1]}return h.join(" ")}var d=PickyI18n.locale,n=Localization.qualifiers&&Localization.qualifiers[d]||{},v=Localization.explanations&&Localization.explanations[d]||{};d=Localization.location_delimiters[d];this.explanation=this.query=this.text="";var x=["street_number","zipcode"];this.contract=g;var A={maiden_name:{format:"(-%1$s)",
method:"capitalize",ignoreSingle:true},name:{format:"<strong>%1$s</strong>",method:"toUpperCase",ignoreSingle:true},first_name:{format:"%1$s",method:"capitalize"}};this.who=c;var y={zipcode:":zipcode ["+v.city+"]",city:":city","city,zipcode":":zipcode :city"};this.where=p;this.what=e;var B=["first_name","name","maiden_name"],E=["zipcode","city"];this.trisect=q;var C=", ",k=" "+d+"&nbsp;";this.fuse=s;this.querify=r;this.render=function(a){var h=a.combination,m=a.count;a=r(h);h=s(q(h));h=$('<li><div class="text">'+
h+'</div><div class="count">'+m+"</div></li>");h.bind("click",{query:a},b);return h}};var PickyAllocationsCloud=function(b){var g=$("#picky .allocations"),i=g.find(".shown"),c=g.find(".more"),f=g.find(".hidden"),p=function(){g.hide()},u=new AllocationRenderer(function(s){p();b.allocationChosen(s)}),e=function(s){var r=[];s.each(function(d,n){r.push(u.render(n))});return r},q=function(s){if(s.length==0)return $("#search .allocations").hide();i.empty();c.hide();f.empty().hide();if(s.length>3){$.each(s.slice(0,2),function(r,d){i.append(d)});$.each(s.slice(2),function(r,d){f.append(d)});
c.show()}else $.each(s,function(r,d){i.append(d)});return $("#search .allocations").show()};c.click(function(){c.hide();f.show()});this.hide=p;this.show=function(s){q(e(s.allocations));g.show()}};
