Array.prototype.index=function(b){for(var d=0,g=this.length;d<g;d++)if(this[d]==b)return d;return null};Array.prototype.include=function(b){return this.index(b)!==null};Array.prototype.remove=function(b){this.splice(b,1);return this};var PickyI18n={};$(function(){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en"});
var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(b){for(var d=PickyI18n.locale||
"en",g=b.split(".").concat(d),c=dictionary,e=0,r=g.length;e<r;e++){c=c[g[e]];if(c==undefined){c="Translation missing: "+b+"."+d;break}}return c};function Allocation(b,d,g,c,e,r){var f=this;this.type=b;this.weight=d;this.count=g;this.combination=c;this.ids=e||[];this.entries=this.rendered=r||[];this.isType=function(k){return k==f.type}}function Allocations(b){this.allocations=[];for(var d=0,g=b.length;d<g;d++){var c=b[d];this.allocations.push(new Allocation(c[0],c[1],c[2],c[3],c[4],c[5]))}this.length=this.allocations.length;this.each=function(e){return $.each(this.allocations,e)}}
function PickyData(b){var d=b.total,g=b.duration,c=b.offset;b=new Allocations(b.allocations||[]);this.total=d;this.duration=g;this.offset=c;this.allocations=b;this.isEmpty=function(){return d==0}};var PickyView=function(b,d){var g=d.showResultsLimit||10,c=$("#picky input.query"),e=$("#picky div.reset"),r=$("#picky input.search_button"),f=$("#picky div.status"),k=$("#picky .dashboard"),s=$("#picky .results"),o=$("#picky .no_results"),u=new PickyAddination(this,s),h=new PickyAllocationsCloud(this),p=new PickyResultsRenderer(u),w=function(){e.fadeTo(166,1)},x=function(){h.hide();s.empty();o.hide()},D=function(m){c.val(m);e.fadeTo(166,0);B("empty");f.empty();x()},y=function(){return c.val()};this.text=
y;var A=function(m){f.text(m);m>0&&m<=5&&f.fadeTo("fast",0.5).fadeTo("fast",1)},E=function(m){if(m.isEmpty())return"none";if(m.total>g&&m.allocations.length>1)return"support";return"ok"},B=function(m){k.attr("class","dashboard "+m)};this.insert=function(m){c.val(m);c.select()};this.fullResultsCallback=function(m){B(E(m));if(m.isEmpty()){x();A(0);o.show();w()}else if(m.total>g&&m.allocations.length>1){x();w();h.show(m);A(m.total)}else if(m.offset==0){x();A(m.total);p.render(m);s.show();w()}else{u.remove();
p.render(m);$.scrollTo("#picky .results div.header:last",{duration:500,offset:-12})}c.focus()};this.liveResultsCallback=function(m){B(E(m));A(m.total)};this.allocationChosen=function(m){m=m.data.query;c.val(m);b.allocationChosen(m)};this.addinationClicked=function(m){b.addinationClicked(y(),m)};(function(){c.keyup(function(m){if(y()==""){D();b.searchTextCleared()}else{b.searchTextEntered(y(),m);w()}});r.click(function(){y()==""||b.searchButtonClicked(y())});e.click(function(){D("");b.clearButtonClicked();
c.focus()})})();c.focus()};var PickyBackend=function(b){var d=function(g,c,e,r){var f=r||{};f=$.extend({query:g,offset:e},r);$.getJSON(b,f,function(k){c&&c(new PickyData(k))})};this.search=function(g,c,e,r,f){d(g,function(k){c&&c(f,k)},e,r)}},LiveBackend=function(b){var d=new PickyBackend(b);this.search=function(g,c,e,r,f){f=f||{};latestRequestTimestamp=new Date;f.live=latestRequestTimestamp;d.search(g,function(k,s){if(!k.live||k.live==latestRequestTimestamp)c&&c(s)},e,r,f)}},FullBackend=function(b){var d=new PickyBackend(b);
this.search=function(g,c,e,r,f){f=f||{};latestRequestTimestamp=new Date;f.full=latestRequestTimestamp;d.search(g,function(k,s){if(!k.full||k.full==latestRequestTimestamp)c&&c(s)},e,r,f)}};var PickyController=function(b){var d=new PickyView(this,b),g=b.backends,c=b.before||function(){},e=b.success||function(){},r=b.after||function(){},f=function(h,p){h=e(h,p)||h;d.liveResultsCallback(h);r(h,p)},k,s=function(){var h=d.text();c({});var p=g.live;p&&p.search(h,f,0,void 0);clearInterval(k)};k=setInterval(s,180);clearInterval(k);var o=function(h,p){h=e(h,p)||h;d.fullResultsCallback(h);r(h,p)},u=function(h,p,w){w=w||{};p=p||0;clearInterval(k);$.address&&$.address.parameter("q",h);w=c(w,h,
p)||w;var x=g.full;x&&x.search(h,o,p,w)};this.insert=function(h,p){d.insert(h);p&&u(h)};this.clearButtonClicked=function(){clearInterval(k)};this.searchTextCleared=function(){clearInterval(k)};this.searchTextEntered=function(h,p){if($.inArray(p.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)if(p.keyCode==13)u(h);else{clearInterval(k);k=setInterval(s,180)}};this.searchButtonClicked=function(h){u(h)};this.allocationChosen=
function(h){u(h)};this.addinationClicked=function(h,p){u(h,p.data.offset)}};var Localization={location_delimiters:{de:"in",fr:"\u00e0",it:"a",en:"in",ch:"in"},explanation_delimiters:{de:"und",fr:"et",it:"e",en:"and",ch:"und"}},PickyClient=function(b){Localization.qualifiers=b.qualifiers||{};Localization.explanations=b.explanations||{};Localization.explanation_delimiters={de:"und",fr:"et",it:"e",en:"and",ch:"und"};var d=b.backends;if(d){d.live||alert("Both a full and live backend must be provided.");d.full||alert("Both a full and live backend must be provided.")}else b.backends=
{live:b.live&&new LiveBackend(b.live)||alert("A live backend path must be provided."),full:b.full&&new FullBackend(b.full)||alert("A live backend path must be provided.")};var g=b.controller&&new b.controller(b)||new PickyController(b);var c=this.insert=function(e,r){g.insert(e,r||true)};this.insertFromURL=function(e){if(e&&e!="")c(e);else $.address&&c($.address.parameter("q"))};$.address&&$.address.externalChange(function(e){(e=e.parameters.q)&&c(e)})};var PickyAddination=function(b,d){this.remove=function(){d.find(".addination").remove()};this.render=function(g){var c=g.total,e=void 0;e=e||0;e=g.offset+20+e;var r=e+20;g=g.total;if(g<r)r=g;g={offset:e,start:e+1,end:r};if(g.offset<c){c=$("<div class='addination current'>"+t("results.addination.more")+"</div>");c.bind("click",{offset:g.offset},b.addinationClicked);return c}else return""}};var PickyResultsRenderer=function(b){var d=["street_number","zipcode"],g=function(f){var k=f[f.length-1];f=f.slice(0,f.length-1);if(f==[])f=[f];if(!d.include(k[0]))if(k[1].match(/[^\*~]$/))k[1]+="*";f.push(k);return f},c=function(f){for(var k=Localization.explanations&&Localization.explanations[PickyI18n.locale]||{},s=[],o,u=0,h=f.length;u<h;u++){o=f[u];var p=o[0];p=k[p]||p;s.push([p,o[1]])}return s},e=function(f,k){var s=Localization.explanation_delimiters[PickyI18n.locale],o=c(g(k));o=$.map(o,function(u){return[u[0].replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0]+)/,
"<strong>$1</strong>"),u[1]].join(" ")});o=o.join(" "+s+" ");return'<span class="explanation">'+f+" "+o+"</span>"},r=function(f,k){var s='<div class="header">';s+=e(k.type,k.combination);if(f.offset>0)s+='<div class="tothetop"><a href="javascript:$.scrollTo(0,{ duration: 500 });">&uarr;</a></div>';return s};this.render=function(f){var k=$("#picky div.results");f.allocations.each(function(s,o){k.append(r(f,o)).append('<ol class="results">'+o.entries.join("")+"</ol>").append(b.render(f))})}};function AllocationRenderer(b){function d(a){var i={},n={},j=[],q;q=0;for(l=a.length;q<l;q++){var v=a[q][0];if(v in i){i[v]=i[v]+" "+a[q][1];j.push(q)}else{i[v]=a[q][1];n[q]=v}}for(q in n)a[q][1]=i[n[q]];for(q=j.length-1;q>=0;q--)a.remove(j[q]);return a}function g(a,i){var n=i||false,j=a[0],q=a[1],v=D[j];if(v){if(v.method)q=q[v.method]();if(v.format)q=v.format.replace(/%1\$s/,q)}j=w[j]||j;if(n&&!(v&&v.ignoreSingle))return q+"&nbsp;("+j+")";return q}function c(a){if(a.length==0)return"";else if(a.length==
1)return g(a[0],true);else{var i=[],n=[];a=d(a);for(var j=0,q=a.length;j<q;j++)if(a[j][0]=="first_name")i.unshift(g(a[j]));else a[j][0]=="maiden_name"?n.push(g(a[j])):i.push(g(a[j]));n.length>0&&i.push(n);return i.join(" ")}}function e(a){return function(i,n){for(var j=0,q=a.length;j<q;j++)if(a[j][0]==n)return a[j][1];return""}}function r(a){if(a.length==0)return"";var i=a=d(a);i.sort(function(v,z){return v[0]<z[0]?-1:1});for(var n=[],j=0,q=i.length;j<q;j++)n.push(i[j][0]);return y[n].replace(/:(zipcode|city)/g,
e(a))}function f(a){var i=a[0];return a[1]+"&nbsp;("+(w[i]||i)+")"}function k(a){if(a.length==0)return"";result=[];a=d(a);for(var i=0,n=a.length;i<n;i++)result.push(f(a[i]));return result.join(", ")}function s(a){for(var i=[],n=[],j=[],q=0,v=a.length;q<v;q++){var z=a[q];if(E.include(z[0]))j.push(z);else A.include(z[0])?i.push(z):n.push(z)}var C;if(j.length>0)C=j[j.length-1];else if(n.length>0)C=n[n.length-1];else if(i.length>0)C=i[i.length-1];x.include(C[0])||(C[1]+="...");a=c(i);n=k(n);j=r(j);return[a,
n,j]}function o(a){var i=a[0],n=a[1];a=a[2];var j="";j=i!=""?n!=""?[i,n].join(B):i:n;if(a=="")return j;return[j,a].join(m)}function u(a){var i=[],n,j;for(j in a){n=a[j][0];n=p[n]||n;i[j]=n+":"+a[j][1]}return i.join(" ")}var h=PickyI18n.locale,p=Localization.qualifiers&&Localization.qualifiers[h]||{},w=Localization.explanations&&Localization.explanations[h]||{};h=Localization.location_delimiters[h];this.explanation=this.query=this.text="";var x=["street_number","zipcode"];this.contract=d;var D={maiden_name:{format:"(-%1$s)",
method:"capitalize",ignoreSingle:true},name:{format:"<strong>%1$s</strong>",method:"toUpperCase",ignoreSingle:true},first_name:{format:"%1$s",method:"capitalize"}};this.who=c;var y={zipcode:":zipcode ["+w.city+"]",city:":city","city,zipcode":":zipcode :city"};this.where=r;this.what=k;var A=["first_name","name","maiden_name"],E=["zipcode","city"];this.trisect=s;var B=", ",m=" "+h+"&nbsp;";this.fuse=o;this.querify=u;this.render=function(a){var i=a.combination,n=a.count;a=u(i);i=o(s(i));i=$('<li><div class="text">'+
i+'</div><div class="count">'+n+"</div></li>");i.bind("click",{query:a},b);return i}};var PickyAllocationsCloud=function(b){var d=$("#picky .allocations"),g=d.find(".shown"),c=d.find(".more"),e=d.find(".hidden"),r=function(){d.hide()},f=new AllocationRenderer(function(o){r();b.allocationChosen(o)}),k=function(o){var u=[];o.each(function(h,p){u.push(f.render(p))});return u},s=function(o){if(o.length==0)return $("#search .allocations").hide();g.empty();c.hide();e.empty().hide();if(o.length>3){$.each(o.slice(0,2),function(u,h){g.append(h)});$.each(o.slice(2),function(u,h){e.append(h)});
c.show()}else $.each(o,function(u,h){g.append(h)});return $("#search .allocations").show()};c.click(function(){c.hide();e.show()});this.hide=r;this.show=function(o){s(k(o.allocations));d.show()}};
